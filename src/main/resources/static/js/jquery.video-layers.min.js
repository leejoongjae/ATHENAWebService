/**
 * @license jq-video-layers v1.0.0
 * (c) 2018 Finsi, Inc.
 */

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.jqVideoLayers={})}(this,function(e){"use strict";var t,s=function(){return function(e){for(var t in void 0===e&&(e={}),e)this[t]=e[t]}}();(t=e.VideoLayersEvents||(e.VideoLayersEvents={})).beforeShowLayer="videoLayer:beforeShowLayer",t.showLayer="videoLayer:showLayer",t.beforeHideLayer="videoLayer:beforeHideLayer",t.hideLayer="videoLayer:hideLayer";var i=function(){function t(){}return t.prototype.destroy=function(){this.element.unwrap(),this._super()},t.prototype.addLayer=function(e){},t.prototype._getCreateOptions=function(){return{namespace:"jq-videolayers",classes:{root:"c-video-layers",video:"c-video-layers__video",layer:"c-video-layers__layer",visible:"c-video-layers__visible",layersContainer:"c-video-layers__container"},layers:[]}},t.prototype._create=function(){var e=this.options.useParentAsContainer;if(e)if("string"==typeof e){if(this.wrapperEl=this.element.parents(e),0==this.wrapperEl.length)throw"[VideoLayers] useParentAsContainer must match with an existing element, the query provided doesn't match with any element"}else this.wrapperEl=e;else this.wrapperEl=$("<div></div>"),this.wrapperEl.insertAfter(this.element),this.element.appendTo(this.wrapperEl);this.wrapperEl.addClass(this.options.classes.root),this.layersContainer=$('<div class="'+this.options.classes.layersContainer+'"></div>'),this.wrapperEl.append(this.layersContainer),this.element.addClass(this.options.classes.video),this.layers=[],this.visibleLayers=[],this.hiddenLayers=[],this._assignEvents(),this._processLayers(this.options.layers)},t.prototype._onTimeUpdate=function(e){for(var t=e.target.currentTime,s=this.visibleLayers,i=this.hiddenLayers,r=[],o=[],n=0,a=s.length;n<a;n++){var p=s[n];(t>=p.stop||t<p.start)&&(this._hideLayer(p),o.push(s.splice(n,1)[0]),a--,n--)}for(var h=0,l=i.length;h<l;h++){var y=i[h];t>=y.start&&(void 0==y.stop||t<y.stop)&&(this._showLayer(y),r.push(i.splice(h,1)[0]),l--,h--)}this.visibleLayers=s.concat(r),this.hiddenLayers=i.concat(o)},t.prototype._assignEvents=function(){this.element.off("."+this.options.namespace),this.element.on("timeupdate."+this.options.namespace,this._onTimeUpdate.bind(this))},t.prototype._showLayer=function(t){var s=this,i=t.element;this.element.trigger(e.VideoLayersEvents.beforeShowLayer,{instance:this,layer:t}),i.addClass(this.options.classes.visible),t.position&&(Array.isArray(t.position)?i.css({left:t.position[0],top:t.position[1]}):(t.position.of=t.position.of||this.wrapperEl,i.position(t.position))),t.show?(t.show.complete=function(){s.element.trigger(e.VideoLayersEvents.showLayer,{instance:s,layer:t})},i.show(t.show)):(i.show(),this.element.trigger(e.VideoLayersEvents.showLayer,{instance:this,layer:t}))},t.prototype._hideLayer=function(t){var s=this,i=t.element;this.element.trigger(e.VideoLayersEvents.beforeHideLayer,{instance:this,layer:t}),t.hide?(t.hide.complete=function(){i.removeClass(s.options.classes.visible),s._resetPosition(t),s.element.trigger(e.VideoLayersEvents.hideLayer,{instance:s,layer:t})},i.hide(t.hide)):(i.hide().removeClass(this.options.classes.visible),this._resetPosition(t),this.element.trigger(e.VideoLayersEvents.hideLayer,{instance:this,layer:t}))},t.prototype._resetPosition=function(e){e.position&&!Array.isArray(e.position)&&e.element.css({left:"",top:""})},t.prototype._processLayers=function(e){for(var t=[],i=0,r=e.length;i<r;i++){var o=new s($.extend(!0,{},e[i])),n=void 0;if(o.element?("string"==typeof o.element&&(o.element=$(o.element)),0!=o.appendToLayers&&this.layersContainer.append(o.element)):(o.element=$("<div>"+o.content+"</div>"),this.layersContainer.append(o.element)),void 0==(n=o.element)||0==n.length)throw"[VideoLayers] The layer must has an element or a content";n.addClass(this.options.classes.layer),o.styles&&n.css(o.styles),n.addClass(o.cssClass),t.push(o)}this.layers=this.layers.concat(t),this.hiddenLayers=this.hiddenLayers.concat(t)},t}();if(Object.hasOwnProperty("getOwnPropertyDescriptors")){for(var r={},o=Object.getOwnPropertyNames(i.prototype),n=0,a=o.length;n<a;n++){var p=o[n];r[p]=Object.getOwnPropertyDescriptor(i.prototype,p).value}$.widget("ui.videoLayers",r)}else $.widget("ui.videoLayers",i);e.VideoLayer=s,e.VideoLayers=i,Object.defineProperty(e,"__esModule",{value:!0})});
